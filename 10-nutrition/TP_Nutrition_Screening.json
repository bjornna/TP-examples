[{
        "$type": "WORK_PLAN",
        "name": "Nutrition screening at hospital",
        "description": "All patients admitted at hospital should be screened for nutrition",
        "plans": [{
                "value": "TP_Nutrition_Screening"
            },
            {
                "value": "TP_DOCTOR_ASSESSMENT"
            },
            {
                "value": "TP_CLIN_NUTR_PHYS"
            }
        ]
    },
    {
        "$type": "TASK_PLAN",
        "uid": {
            "value": "TP_Nutrition_Screening"
        },
        "name": "Initial screening",
        "description": "Initial screening",
        "principal_performer": "nurse_on_duty",
        "definition": {
            "$type": "TASK_GROUP",
            "uid": {
                "value": "TG_Initial_Screening"
            },
            "members": [{
                    "$type": "PERFORMABLE_TASK",
                    "name": "Nutritional Risk Screening (NRS 2002)",
                    "description": "Screening for malnutrition using the tool NRS 2002.",
                    "action": {
                        "$type": "DEFINED_ACTION",
                        "subject_preconditions": [{
                            "$type": "SUBJECT_PRECONDITION",
                            "description": "BMI < 20.5",
                            "expression": {
                                "$type": "BOOLEAN_CONTEXT_EXPRESSION",
                                "value": "$bmi.magnitude < 20.5"
                            }
                        }],
                        "prototype": [],
                        "optionality": "optional"
                    },
                    "capture_dataset": [{
                        "$type": "DATASET_SPEC",
                        "form_id": "NRS2002.v2.1.0",
                        "template_id": "NRS2002_Screening"
                    }]
                },
                {
                    "$type": "DECISION_GROUP",
                    "name": "Decide follow up",
                    "uid": {
                        "value": "DG_Decide_Follow_Up"
                    },
                    "test": {
                        "$type": "CONTEXT_EXPRESSION",
                        "name": "TotalScore  of openEHR-EHR-OBSERVATION.nutritional_risk_screening.v1 ",
                        "expression": "SELECT o/data[at0001]/events[at0002]/data[at0003]/items[at0032]/items[at0030]/value/magnitude as nutrition_score FROM COMPOSITION c  contains OBSERVATION o[openEHR-EHR-OBSERVATION.nutritional_risk_screening.v1] ORDER BY o/data[at0001]/events[at0002]/time desc",
                        "type": "INTEGER",
                        "_comment": "The expression is an AQL - and the result is an integer which is used in the descision branch below"
                    },
                    "members": [{
                            "$type": "DECISION_BRANCH",
                            "name": "Low risk: Routine screening",
                            "uid": {
                                "value": "LOW_RISK_GROUP"
                            },
                            "value_constraint": {
                                "$type": "BOOLEAN_CONTEXT_EXPRESSION",
                                "value": "$nutrion_score <= 0"
                            },
                            "members": [{
                                "$type": "PERFORMABLE_TASK",
                                "name": "Repeat screening in a week",
                                "description": "Need some more details on how to make this branch correct"
                            }]
                        },
                        {
                            "$type": "DECISION_BRANCH",
                            "name": "Medium risk: Observation",
                            "uid": {
                                "value": "MEDIUM_RISK_GROUP"
                            },
                            "value_constraint": {
                                "$type": "BOOLEAN_CONTEXT_EXPRESSION",
                                "value": "$nutrion_score == 1 || $nutrition_score == 2"
                            },
                            "members": [{
                                "$type": "PERFORMABLE_TASK",
                                "name": "Observasjon",
                                "description": "Middels risiko pasient. Dokumenter nÃ¦ringsinntak i tre dager. ",
                                "action": {
                                    "$type": "DEFINED_ACTION",
                                    "optionality": "optional"
                                },
                                "capture_dataset": [{
                                    "$type": "DATASET_SPEC",
                                    "form_id": "Nutrient_intake.v1.0.0",
                                    "template_id": "Nutrient_intake_at_hospital"
                                }]
                            }]
                        },
                        {
                            "$type": "DECISION_BRANCH",
                            "name": "High risk: Take action",
                            "uid": {
                                "value": "HIGH_RISK_GROUP"
                            },
                            "value_constraint": {
                                "$type": "BOOLEAN_CONTEXT_EXPRESSION",
                                "value": "$nutrion_score >= 3"
                            },
                            "members": [{
                                "name": "Request clinical nutrition physiologist",
                                "$type": "HAND_OFF",
                                "target": "TP_CLIN_NUTR_PHYS",
                                "wait": "false"
                            }]
                        }
                    ]
                }
            ]
        }
    },
    {
        "$type": "TASK_PLAN",
        "uid": {
            "value": "TP_DOCTOR_ASSESSMENT"
        },
        "name": "Nutriotional Risk Outcome Assessment",
        "description": "The doctor evaluates effect",
        "principal_performer": "doctor",
        "definition": {
            "$type": "TASK_GROUP",
            "uid": {
                "value": "TG_Doctor_Assessment"
            },
            "members": [{
                    "$type": "PERFORMABLE_TASK",
                    "name": "Evaluate effect",
                    "description": "Evaluate effect of nutrition actions",
                    "action": {
                        "$type": "DEFINED_ACTION",
                        "optionality": "mandatory"
                    },
                    "capture_dataset": [{
                        "$type": "DATASET_SPEC",
                        "form_id": "EvaluateNutritionEffect.v1.0.0",
                        "template_id": "EvaluteNutritionEffectByDoctor"
                    }]
                },
                {
                    "$type": "DECISION_GROUP",
                    "name": "Choose follow-up strategy",
                    "uid": {
                        "value": "DG_Doctor_Choos_Follow_Up_Strategy"
                    },
                    "test": {
                        "$type": "CONTEXT_EXPRESSION",
                        "name": "Evaluate effect",
                        "expression": "$hasEffect",
                        "type": "BOOLEAN"
                    },
                    "members": [{
                        "$type": "DECISION_BRANCH",
                        "name": "Has effect",
                        "uid": {
                            "value": "has_effect_of_actions"
                        },
                        "value_constraint": {
                            "$type": "BOOLEAN_CONTEXT_EXPRESSION",
                            "value": "$hasEffect"
                        },
                        "members": [{
                            "$type": "PERFORMABLE_TASK",
                            "name": "Follow up in n days",
                            "description": "The doctor should be able to tell when to repeat the assessment"
                        }]
                    }, {
                        "$type": "DECISION_BRANCH",
                        "name": "No effect",
                        "uid": {
                            "value": "has_no_effect_of_actions"
                        },
                        "value_constraint": {
                            "$type": "BOOLEAN_CONTEXT_EXPRESSION",
                            "value": "! $hasEffect"
                        },
                        "members": [

                            {
                                "name": "Request clinical nutrition physiologist",
                                "$type": "HAND_OFF",
                                "target": "TP_CLIN_NUTR_PHYS",
                                "wait": "false"
                            }

                        ]
                    }]
                }
            ]
        }
    },
    {
        "$type": "TASK_PLAN",
        "uid": {
            "value": "TP_CLIN_NUTR_PHYS"
        },
        "name": "Follow up by clinical nutrition physiologist",
        "principal_performer": "Clinical Nutrition Physiologist",
        "definition": {
            "$type": "TASK_GROUP",
            "uid": {
                "value": "CLIN_NUTR_PHYS_01"
            },
            "members": [{
                "$type": "PERFORMABLE_TASK",
                "name": "Evaluate patient",
                "description": "I have no idea what to fill in this plan..... ",
                "action": {
                    "$type": "DEFINED_ACTION"
                },
                "capture_dataset": [{
                    "$type": "DATASET_SPEC",
                    "form_id": "InitialScreeningByClinNutrPhysiologist.v1.0.0",
                    "template_id": "Nutrition_Screening_By_ClinNutrPhys"
                }]
            }]
        }
    }
]